{
  "openapi": "3.1.0",
  "info": {
    "title": "GS - API Documentation",
    "description": "Managing environmental data for better job quality",
    "version": "0.1.0"
  },
  "servers": [
    {
      "url": "http://localhost:8080",
      "description": "OpenAPI Documentation - Development"
    }
  ],
  "security": [
    {
      "bearerAuth": []
    }
  ],
  "tags": [
    {
      "name": "Sensor Readings",
      "description": "Endpoints para recebimento e consulta de leituras dos sensores"
    },
    {
      "name": "Auth",
      "description": "Register and login endpoints"
    },
    {
      "name": "Sectors",
      "description": "Endpoints para gerenciamento de setores do usuário autenticado"
    },
    {
      "name": "Admin - Users",
      "description": "Endpoints administrativos para gestão de usuários"
    },
    {
      "name": "Me",
      "description": "Endpoint para obter informações do usuário autenticado"
    },
    {
      "name": "Sensors",
      "description": "Endpoints para gerenciamento de sensores por setor"
    },
    {
      "name": "Notifications",
      "description": "Endpoints para gerenciamento de notificações do usuário autenticado"
    }
  ],
  "paths": {
    "/api/sensors/{id}": {
      "get": {
        "tags": [
          "Sensors"
        ],
        "summary": "Buscar sensor por id",
        "description": "Retorna um sensor associado a um setor do usuário autenticado.",
        "operationId": "getMySensorById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Sensor encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Sensor não encontrado"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "put": {
        "tags": [
          "Sensors"
        ],
        "summary": "Atualizar sensor",
        "description": "Atualiza os dados de um sensor dos setores do usuário autenticado.",
        "operationId": "updateMySensor",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SensorUpdateRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Sensor atualizado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Sensor não encontrado"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/sectors/{id}": {
      "get": {
        "tags": [
          "Sectors"
        ],
        "summary": "Buscar setor por id",
        "description": "Retorna um setor do usuário autenticado pelo seu identificador.",
        "operationId": "getMySectorById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Setor encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SectorResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Setor não encontrado"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "put": {
        "tags": [
          "Sectors"
        ],
        "summary": "Atualizar setor",
        "description": "Atualiza os dados de um setor do usuário autenticado.",
        "operationId": "updateMySector",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SectorUpdateRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Setor atualizado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SectorResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Setor não encontrado"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "delete": {
        "tags": [
          "Sectors"
        ],
        "summary": "Deletar setor",
        "description": "Remove um setor pertencente ao usuário autenticado.",
        "operationId": "deleteMySector",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "204": {
            "description": "Setor deletado"
          },
          "404": {
            "description": "Setor não encontrado"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/sensors": {
      "get": {
        "tags": [
          "Sensors"
        ],
        "summary": "Listar meus sensores",
        "description": "Lista todos os sensores dos setores pertencentes ao usuário autenticado.",
        "operationId": "getMySensors",
        "responses": {
          "200": {
            "description": "Sensores encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorResponseDTO"
                }
              }
            }
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "post": {
        "tags": [
          "Sensors"
        ],
        "summary": "Criar novo sensor",
        "description": "Cria um sensor associado a um setor do usuário autenticado.",
        "operationId": "createSensor",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SensorCreateRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Sensor criado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Setor não encontrado ou não pertence ao usuário"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/sensor-readings": {
      "get": {
        "tags": [
          "Sensor Readings"
        ],
        "summary": "Listar leituras dos meus sensores",
        "description": "Retorna as leituras associadas aos sensores dos setores pertencentes ao usuário autenticado.",
        "operationId": "getMyReadings",
        "responses": {
          "200": {
            "description": "Leituras encontradas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorReadingResponseDTO"
                }
              }
            }
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "post": {
        "tags": [
          "Sensor Readings"
        ],
        "summary": "Registrar leitura do sensor (webhook)",
        "description": "Webhook público que recebe os dados do sensor (temperatura, umidade, gases, etc.) e registra a leitura, gerando notificações caso algum valor ultrapasse o limite. Protegido por API key via header X-API-KEY.",
        "operationId": "createReading",
        "parameters": [
          {
            "name": "X-API-KEY",
            "in": "header",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SensorReadingCreateRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Leitura registrada",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorReadingResponseDTO"
                }
              }
            }
          },
          "401": {
            "description": "API key inválida ou ausente"
          },
          "404": {
            "description": "Sensor não encontrado"
          },
          "400": {
            "description": "Dados inválidos"
          }
        },
        "security": []
      }
    },
    "/api/sectors": {
      "get": {
        "tags": [
          "Sectors"
        ],
        "summary": "Listar meus setores",
        "description": "Retorna todos os setores vinculados ao usuário autenticado.",
        "operationId": "getMySectors",
        "responses": {
          "200": {
            "description": "Setores encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SectorResponseDTO"
                }
              }
            }
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      },
      "post": {
        "tags": [
          "Sectors"
        ],
        "summary": "Criar novo setor",
        "description": "Cria um setor vinculado ao usuário autenticado (supervisor).",
        "operationId": "createSector",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/SectorCreateRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "Setor criado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SectorResponseDTO"
                }
              }
            }
          },
          "400": {
            "description": "Dados inválidos"
          },
          "401": {
            "description": "Não autenticado"
          },
          "500": {
            "description": "Erro interno"
          }
        }
      }
    },
    "/api/auth/register": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "Register new user",
        "description": "Creates a new user with username, password and email",
        "operationId": "register",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/RegisterRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": {
            "description": "User created",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "400": {
            "description": "Invalid data or existing data"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/auth/login": {
      "post": {
        "tags": [
          "Auth"
        ],
        "summary": "User login",
        "description": "Authenticate the user and returns a JWT token.",
        "operationId": "login",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/LoginRequest"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Login successful",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/LoginResponse"
                }
              }
            }
          },
          "401": {
            "description": "Invalid credentials"
          },
          "500": {
            "description": "Internal server error"
          }
        }
      }
    },
    "/api/notifications/{id}/read": {
      "patch": {
        "tags": [
          "Notifications"
        ],
        "summary": "Marcar notificação como lida",
        "description": "Marca uma notificação do usuário autenticado como lida.",
        "operationId": "markAsRead",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Notificação marcada como lida",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Notificação não encontrada"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/admin/users/{id}/password": {
      "patch": {
        "tags": [
          "Admin - Users"
        ],
        "summary": "Alterar senha de um usuário",
        "description": "Permite ao ADMIN alterar a senha de qualquer usuário.",
        "operationId": "changeUserPassword",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/ChangePasswordRequestDTO"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "description": "Senha alterada com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Usuário não encontrado"
          },
          "403": {
            "description": "Acesso negado (não é ADMIN)"
          }
        }
      }
    },
    "/api/sensor-readings/sensor/{sensorId}/range": {
      "get": {
        "tags": [
          "Sensor Readings"
        ],
        "summary": "Listar leituras por sensor e intervalo de tempo",
        "description": "Retorna as leituras de um sensor específico, pertencente a um setor do usuário autenticado, entre as datas/hora informadas (start e end em formato ISO-8601).",
        "operationId": "getReadingsBySensorAndRange",
        "parameters": [
          {
            "name": "sensorId",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          },
          {
            "name": "start",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          },
          {
            "name": "end",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "format": "date-time"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Leituras encontradas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorReadingResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Sensor não encontrado ou não pertence ao usuário"
          },
          "400": {
            "description": "Parâmetros de data/hora inválidos"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/sensor-readings/sensor/{sensorCode}": {
      "get": {
        "tags": [
          "Sensor Readings"
        ],
        "summary": "Listar leituras por sensor",
        "description": "Retorna as leituras de um sensor específico, desde que pertença a um setor do usuário autenticado.",
        "operationId": "getReadingsBySensor",
        "parameters": [
          {
            "name": "sensorCode",
            "in": "path",
            "required": true,
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Leituras encontradas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/SensorReadingResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Sensor não encontrado ou não pertence ao usuário"
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/notifications": {
      "get": {
        "tags": [
          "Notifications"
        ],
        "summary": "Listar minhas notificações",
        "description": "Retorna todas as notificações do usuário autenticado, podendo filtrar por status.",
        "operationId": "getMyNotifications",
        "parameters": [
          {
            "name": "status",
            "in": "query",
            "required": false,
            "schema": {
              "type": "string",
              "enum": [
                "PENDING",
                "READ"
              ]
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Notificações encontradas",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/NotificationResponseDTO"
                }
              }
            }
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/me": {
      "get": {
        "tags": [
          "Me"
        ],
        "summary": "Obter dados do usuário logado",
        "description": "Retorna username e authorities do usuário autenticado com base no token JWT.",
        "operationId": "me",
        "responses": {
          "200": {
            "description": "Dados do usuário retornados com sucesso",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/MeResponseSchema"
                }
              }
            }
          },
          "401": {
            "description": "Não autenticado"
          }
        }
      }
    },
    "/api/admin/users": {
      "get": {
        "tags": [
          "Admin - Users"
        ],
        "summary": "Listar todos os usuários",
        "description": "Retorna todos os usuários cadastrados. Requer perfil ADMIN.",
        "operationId": "getAllUsers",
        "responses": {
          "200": {
            "description": "Usuários encontrados",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponseDTO"
                }
              }
            }
          },
          "403": {
            "description": "Acesso negado (não é ADMIN)"
          }
        }
      }
    },
    "/api/admin/users/{id}": {
      "get": {
        "tags": [
          "Admin - Users"
        ],
        "summary": "Buscar usuário por id",
        "description": "Retorna os dados de um usuário pelo id. Requer perfil ADMIN.",
        "operationId": "getUserById",
        "parameters": [
          {
            "name": "id",
            "in": "path",
            "required": true,
            "schema": {
              "type": "integer",
              "format": "int64"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Usuário encontrado",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/UserResponseDTO"
                }
              }
            }
          },
          "404": {
            "description": "Usuário não encontrado"
          },
          "403": {
            "description": "Acesso negado (não é ADMIN)"
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "SensorUpdateRequestDTO": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "minLength": 1
          }
        },
        "required": [
          "code"
        ]
      },
      "SensorResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "code": {
            "type": "string"
          },
          "sectorId": {
            "type": "integer",
            "format": "int64"
          },
          "sectorName": {
            "type": "string"
          }
        }
      },
      "SectorUpdateRequestDTO": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string"
          }
        },
        "required": [
          "name"
        ]
      },
      "SectorResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "supervisorId": {
            "type": "integer",
            "format": "int64"
          },
          "supervisorName": {
            "type": "string"
          }
        }
      },
      "SensorCreateRequestDTO": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string",
            "minLength": 1
          },
          "sectorId": {
            "type": "integer",
            "format": "int64"
          }
        },
        "required": [
          "code",
          "sectorId"
        ]
      },
      "SensorReadingCreateRequestDTO": {
        "type": "object",
        "properties": {
          "code": {
            "type": "string"
          },
          "temperatura": {
            "type": "number",
            "format": "double"
          },
          "umidade": {
            "type": "number",
            "format": "double"
          },
          "co": {
            "type": "number",
            "format": "double"
          },
          "co2": {
            "type": "number",
            "format": "double"
          },
          "ch4": {
            "type": "number",
            "format": "double"
          },
          "h2s": {
            "type": "number",
            "format": "double"
          }
        },
        "required": [
          "code"
        ]
      },
      "SensorReadingResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "sensorId": {
            "type": "integer",
            "format": "int64"
          },
          "sensorCode": {
            "type": "string"
          },
          "temperature": {
            "type": "number",
            "format": "double"
          },
          "humidity": {
            "type": "number",
            "format": "double"
          },
          "co": {
            "type": "number",
            "format": "double"
          },
          "co2": {
            "type": "number",
            "format": "double"
          },
          "ch4": {
            "type": "number",
            "format": "double"
          },
          "h2s": {
            "type": "number",
            "format": "double"
          },
          "timestamp": {
            "type": "string",
            "format": "date-time"
          }
        }
      },
      "SectorCreateRequestDTO": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string",
            "minLength": 1
          },
          "description": {
            "type": "string"
          },
          "supervisorId": {
            "type": "integer",
            "format": "int64"
          }
        },
        "required": [
          "name",
          "supervisorId"
        ]
      },
      "RegisterRequest": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "telephone": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        }
      },
      "LoginResponse": {
        "type": "object",
        "properties": {
          "message": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "token": {
            "type": "string"
          }
        }
      },
      "LoginRequest": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string"
          },
          "password": {
            "type": "string"
          }
        }
      },
      "NotificationResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "title": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "metric": {
            "type": "string"
          },
          "measuredValue": {
            "type": "number",
            "format": "double"
          },
          "thresholdValue": {
            "type": "number",
            "format": "double"
          },
          "status": {
            "type": "string",
            "enum": [
              "PENDING",
              "READ"
            ]
          },
          "createdAt": {
            "type": "string",
            "format": "date-time"
          },
          "readAt": {
            "type": "string",
            "format": "date-time"
          },
          "sectorId": {
            "type": "integer",
            "format": "int64"
          },
          "sectorName": {
            "type": "string"
          }
        }
      },
      "ChangePasswordRequestDTO": {
        "type": "object",
        "properties": {
          "newPassword": {
            "type": "string"
          }
        }
      },
      "UserResponseDTO": {
        "type": "object",
        "properties": {
          "id": {
            "type": "integer",
            "format": "int64"
          },
          "name": {
            "type": "string"
          },
          "telephone": {
            "type": "string"
          },
          "username": {
            "type": "string"
          },
          "email": {
            "type": "string"
          }
        }
      },
      "MeResponseSchema": {
        "type": "object",
        "properties": {
          "username": {
            "type": "string"
          },
          "authorities": {

          }
        }
      }
    },
    "securitySchemes": {
      "bearerAuth": {
        "type": "http",
        "name": "bearerAuth",
        "in": "header",
        "scheme": "bearer",
        "bearerFormat": "JWT"
      }
    }
  }
}